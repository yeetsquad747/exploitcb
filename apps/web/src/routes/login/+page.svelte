<script lang="ts">
    import { browser } from '$app/environment';
  import { Button, TextInput } from 'ui';

  let password = '';
  let handle = '';

  async function submit() {
    const data = await fetch('/api/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        handle,
        password
      })
    }).then((res) => res.json());
    return data;
  }
  let submitData: string = '';
  $: {
    if (submitData.length >= 191 && browser) {
      window.localStorage.setItem('token', submitData);
      submitData = 'Success';
    }
  }
</script>

<div class="container">
  <div class="rainbow">
    <h1>Log In</h1>
  </div>
  <TextInput bind:value="{handle}" placeholder="Handle" />
  <br />
  <br />
  <TextInput bind:value="{password}" placeholder="Password" />
  <br />
  <br />
  <Button color="blue" on:click="{async () => submitData = await submit()}">Submit</Button>
  {#if submitData === 'Invalid user'}
    <p>Invalid user</p>
  {:else if submitData === 'There was an error on the server'}
    <p>There was an error on the server</p>
  {:else if submitData === 'Invalid password'}
    <p>Invalid password</p>
  {:else if submitData === 'Success'}
    <p>Success!</p>
  {/if}
</div>

<style>
  .container {
    position: fixed;
    width: 100%;
    height: 100%;
    text-align: center;
    font-family: 'Courier New', Courier, monospace;
    color: var(--green);
    background-color: black;
    margin: -0.5em;
  }
</style>
