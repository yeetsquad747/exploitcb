<script lang="ts">
  import { TextInput, Button } from "ui";
  import type { PageData } from "./$types";
  import { HCaptcha } from "ui";
  export let data: PageData;
  let handle = "";
  let email = "";
  let username = "";
  let password = "";
  let captchaToken: any = "";
  let submitData: any = "";
  let captcha: HCaptcha;
  async function submit() {
    const data = await fetch("/api/register", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        handle,
        email,
        username,
        password,
        "token": String(captchaToken),
      }),
    });
    return data;
  }
</script>

<div class="container">
  <div class="rainbow">
    <h1>Register to join {data.count} {data.count === 1 ? 'user' : 'users'}</h1>
  </div>
  <TextInput bind:value={handle} placeholder="Handle" />
  <br>
  <br>
  <TextInput bind:value={email} placeholder="Email" />
  <br>
  <br>
  <TextInput bind:value={username} placeholder="Username"></TextInput>
  <br>
  <br>
  <TextInput bind:value={password} placeholder="Password"></TextInput>
  <br>
  <br>
  <HCaptcha bind:this={captcha} on:error={() => captcha.reset()} on:success={(token) => captchaToken = token} sitekey="e7757d50-4766-4ef1-8e1f-8d8792b400e3"></HCaptcha>
  <br>
  <Button on:click={async () => submitData = await submit()}>Submit</Button>
  {#if submitData === "Email already in use."}
    <p>Email already in use.</p>
    {:else if submitData === "Handle is already in use"}
      <p>Handle is already in use</p>
    {:else if submitData === "Please send a valid email"}
      <p>Please send a valid email</p>
    {:else if submitData === "Success"}
      <p>Success</p>
  {/if}
</div>

<style>
  .container {
    position: fixed;
    width: 100%;
    height: 100%;
    text-align: center;
    font-family: 'Courier New', Courier, monospace;
    color: var(--green);
    background-color: black;
    margin: -0.5em;
  }
</style>
